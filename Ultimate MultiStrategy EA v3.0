//+------------------------------------------------------------------+
//| Ultimate MultiStrategy EA v3.0                                   |
//| ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ Ù…Ø¹Ø§Ù‹ Ù…Ø¹ Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©     |
//+------------------------------------------------------------------+
#property copyright "2025"
#property version   "3.0"
#property strict
#include <Trade\Trade.mqh>

CTrade trade;

//--- enums
enum SignalType { NONE, BUY, SELL };
enum StrategyMode { MODE_CONSERVATIVE, MODE_AGGRESSIVE, MODE_SNIPER };
enum OrderExecutionType { MARKET_EXECUTION, LIMIT_ORDERS, STOP_ORDERS };

//--- inputs
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
input bool      EnableConservativeMode  = true;      // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸
input bool      EnableAggressiveMode    = true;      // ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø¯ÙˆØ§Ù†ÙŠ
input bool      EnableSniperMode        = true;      // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ù†Ø§Øµ
input double    ConservativeRiskPercent = 0.01;      // Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸ (1%)
input double    AggressiveRiskPercent   = 0.002;     // Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø¯ÙˆØ§Ù†ÙŠ (0.5%)
input double    SniperRiskPercent       = 0.02;      // Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ù†Ø§Øµ (2%)

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙÙ„Ø§ØªØ±
input bool      EnableRSIFilter         = false;     // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ ÙÙ„ØªØ± RSI
input bool      UseSimpleMode           = true;      // ØªØ¬Ø§ÙˆØ² Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©
input bool      DisableRepeating        = false;     // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
input int       RSI_Period               = 14;
input int       RSI_Oversold             = 30;
input int       RSI_Overbought           = 70;
input int       EMA_Fast                 = 8;
input int       EMA_Slow                 = 21;
input ENUM_TIMEFRAMES HigherTF_EMA      = PERIOD_H1; // Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù€ EMA

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±
input bool      UseFixedLot              = false;     // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø¬Ù… Ø«Ø§Ø¨Øª Ù„Ù„Ø¹Ù‚Ø¯
input double    FixedLot                 = 0.1;       // Ø­Ø¬Ù… Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø«Ø§Ø¨Øª
input int       ATR_Period               = 14;
input double    SL_Multiplier            = 1.0;       // Ù…Ø¶Ø§Ø¹Ù ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© (ATR)
input double    TP_Multiplier            = 1.5;       // Ù…Ø¶Ø§Ø¹Ù Ø¬Ù†ÙŠ Ø§Ù„Ø±Ø¨Ø­ (ATR)
input double    StopLossPct              = 0.15;      // Ù†Ø³Ø¨Ø© ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© (15%)
input double    TakeProfitPct            = 0.74;      // Ù†Ø³Ø¨Ø© Ø¬Ù†ÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© (74%)
input bool      UsePercentageTP_SL       = false;     // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø³Ø¨ Ù…Ø¦ÙˆÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ATR

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø±
input OrderExecutionType ExecutionType   = MARKET_EXECUTION; // Ù†ÙˆØ¹ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆØ§Ù…Ø±
input int       LimitOrderPips           = 10;        // Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
input int       StopOrderPips            = 15;        // Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù

// Ø­Ø¯ÙˆØ¯ Ø§Ù„ØªØ¯Ø§ÙˆÙ„
input int       MaxTradesPerDay          = 5000;
input double    MaxDailyDrawdownPercent  = 0.01;      // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (1%)
input double    TargetBalance            = 3000.0;
input double    ReinvestAmount           = 500.0;
input int       StartHour                = 0;
input int       EndHour                  = 23;
input int       MinEMASpreadPips         = 5;         // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„ÙØ±Ù‚ EMA Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙƒØ²
input int       BreakevenPips            = 15;        // Ù†Ù‚Ù„ ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„ Ø¨Ø¹Ø¯ X Ù†Ù‚Ø·Ø©
input int       TrailingStopPips         = 25;        // ØªÙØ¹ÙŠÙ„ ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…ØªØ­Ø±Ùƒ Ø¨Ø¹Ø¯ X Ù†Ù‚Ø·Ø©
input int       MinDistanceFromMarket    = 10;        // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø¨ÙØ¹Ø¯ SL/TP Ø¹Ù† Ø§Ù„Ø³ÙˆÙ‚ Ø¨Ø§Ù„Ù†Ù‚Ø§Ø·

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©
input bool      UseHammer                = true;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ù…Ø·Ø±Ù‚Ø©
input bool      UseInvertedHammer        = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ù…Ø·Ø±Ù‚Ø© Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø©
input bool      UseEngulfing             = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ø§Ø¨ØªÙ„Ø§Ø¹
input bool      UseDoji                  = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ø¯ÙˆØ¬ÙŠ
input bool      UseMarubozu              = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ù…Ø§Ø±ÙˆØ¨ÙˆØ²Ùˆ
input bool      UsePinBar                = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ø¨Ù† Ø¨Ø§Ø±
input bool      UseHarami                = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ø­Ø±Ø§Ù…ÙŠ
input bool      UseMorningStar           = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ù†Ø¬Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­
input bool      UseEveningStar           = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ù†Ø¬Ù…Ø© Ø§Ù„Ù…Ø³Ø§Ø¡
input bool      UsePiercingLine          = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø®Ø· Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚
input bool      UseDarkCloudCover        = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ
input bool      UseThreeWhiteSoldiers    = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ¶ Ø§Ù„Ø«Ù„Ø§Ø«Ø©
input bool      UseThreeBlackCrows       = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„ØºØ±Ø¨Ø§Ù† Ø§Ù„Ø³ÙˆØ¯ Ø§Ù„Ø«Ù„Ø§Ø«Ø©
input bool      UseTweezer               = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„ØªÙˆÙŠØ²Ø±
input bool      UseKicker                = false;      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø· Ø§Ù„ÙƒÙŠÙƒØ±

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚ÙˆØ© Ø§Ù„Ø£Ù†Ù…Ø§Ø· (Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµÙÙ‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹)
input bool      AutoDistributeByStrength = true;      // ØªÙˆØ²ÙŠØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØµÙÙ‚Ø§Øª Ø­Ø³Ø¨ Ù‚ÙˆØ© Ø§Ù„Ù†Ù…Ø·
input bool      UseStrongPatternsOnly    = false;     // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù‚ÙˆÙŠØ© ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ù†Ø§Øµ

//--- globals
string       g_symbol;
int          g_digits;
int          g_magic_conservative = 123456;
int          g_magic_aggressive   = 234567;
int          g_magic_sniper       = 345678;
int          hRSI, hATR, hEMAFast, hEMASlow, hEMA_HigherTF_Fast, hEMA_HigherTF_Slow;
int          g_tradeCount          = 0;
int          g_lastDay             = -1;
bool         g_paused              = false;
bool         g_reinvesting         = false;
double       g_dayOpenBalance;

double       g_currentRiskPercentage;
int          g_consecutiveWins     = 0;
int          g_consecutiveLosses   = 0;
static string lastSignal           = "";
static ulong lastProcessedDeal     = 0;

// Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØªØ¨Ø¹ Ø§Ù„ØµÙÙ‚Ø§Øª ÙÙŠ ÙƒÙ„ ÙˆØ¶Ø¹
int          g_conservative_trades = 0;
int          g_aggressive_trades   = 0;
int          g_sniper_trades       = 0;

//--- prototypes
// Ø¯ÙˆØ§Ù„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©
bool    IsHammer(bool bullish);
bool    IsInvertedHammer(bool bullish);
bool    IsEngulfing(bool bullish);
bool    IsDoji();
bool    IsMarubozu(bool bullish);
bool    IsPinBar(bool bullish);
bool    IsHarami(bool bullish);
bool    IsMorningStar();
bool    IsEveningStar();
bool    IsPiercingLine();
bool    IsDarkCloudCover();
bool    IsThreeWhiteSoldiers();
bool    IsThreeBlackCrows();
bool    IsTweezerBottom();
bool    IsTweezerTop();
bool    IsBullishKicker();
bool    IsBearishKicker();

// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
double  GetValue(int handle, ENUM_TIMEFRAMES tf, int shift=0);
double  CalculateLotSize(double riskPercent);
void    CheckAndAdjustPositions();
double  PipsToPoints(double pips);
void    HandleAdaptiveLot();
bool    ExecuteTrade(SignalType sig, string patternName, StrategyMode mode);
int     GetPatternStrength(string patternName);

//+------------------------------------------------------------------+
int OnInit()
  {
   g_symbol = Symbol();
   g_digits = (int)SymbolInfoInteger(g_symbol, SYMBOL_DIGITS);

   hRSI = iRSI(g_symbol, PERIOD_CURRENT, RSI_Period, PRICE_CLOSE);
   if(hRSI == INVALID_HANDLE)
     {
      Print("Failed to get RSI handle");
      return(INIT_FAILED);
     }
   hATR = iATR(g_symbol, PERIOD_CURRENT, ATR_Period);
   if(hATR == INVALID_HANDLE)
     {
      Print("Failed to get ATR handle");
      return(INIT_FAILED);
     }
   hEMAFast = iMA(g_symbol, PERIOD_CURRENT, EMA_Fast, 0, MODE_EMA, PRICE_CLOSE);
   if(hEMAFast == INVALID_HANDLE)
     {
      Print("Failed to get EMA Fast handle");
      return(INIT_FAILED);
     }
   hEMASlow = iMA(g_symbol, PERIOD_CURRENT, EMA_Slow, 0, MODE_EMA, PRICE_CLOSE);
   if(hEMASlow == INVALID_HANDLE)
     {
      Print("Failed to get EMA Slow handle");
      return(INIT_FAILED);
     }
   hEMA_HigherTF_Fast = iMA(g_symbol, HigherTF_EMA, EMA_Fast, 0, MODE_EMA, PRICE_CLOSE);
   if(hEMA_HigherTF_Fast == INVALID_HANDLE)
     {
      Print("Failed to get Higher TF EMA Fast handle");
      return(INIT_FAILED);
     }
   hEMA_HigherTF_Slow = iMA(g_symbol, HigherTF_EMA, EMA_Slow, 0, MODE_EMA, PRICE_CLOSE);
   if(hEMA_HigherTF_Slow == INVALID_HANDLE)
     {
      Print("Failed to get Higher TF EMA Slow handle");
      return(INIT_FAILED);
     }

   g_dayOpenBalance = AccountInfoDouble(ACCOUNT_BALANCE);
   g_currentRiskPercentage = ConservativeRiskPercent;

   EventSetTimer(2); // ÙØ­Øµ Ø­Ø¬Ù… Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„ØªÙƒÙŠÙÙŠ ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©

   Print("EA initialized with version 3.0 - Ultimate MultiStrategy with Candlestick Patterns");
   Print("Enabled Modes: ",
         EnableConservativeMode ? "Conservative " : "",
         EnableAggressiveMode ? "Aggressive " : "",
         EnableSniperMode ? "Sniper" : "");
   Print("Execution Type: ", EnumToString(ExecutionType));

   return(INIT_SUCCEEDED);
  }

//+------------------------------------------------------------------+
void OnDeinit(const int reason)
  {
   EventKillTimer();
  }

//+------------------------------------------------------------------+
void OnTimer()
  {
   HandleAdaptiveLot();
  }

//+------------------------------------------------------------------+
//+------------------------------------------------------------------+
//| Ø¯Ø§Ù„Ø© OnTick                                                      |
//+------------------------------------------------------------------+
void OnTick()
  {
   datetime now = TimeCurrent();
   MqlDateTime tm;
   TimeToStruct(now, tm);

// Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
   if(tm.day != g_lastDay)
     {
      g_lastDay = tm.day;
      g_tradeCount = 0;
      g_conservative_trades = 0;
      g_aggressive_trades = 0;
      g_sniper_trades = 0;
      g_paused = false;
      g_reinvesting = false;
      g_dayOpenBalance = AccountInfoDouble(ACCOUNT_BALANCE);
      g_currentRiskPercentage = ConservativeRiskPercent;
      g_consecutiveWins = 0;
      g_consecutiveLosses = 0;
      lastSignal = "";
     }

   double curBal = AccountInfoDouble(ACCOUNT_BALANCE);
   double dd = (g_dayOpenBalance - curBal) / g_dayOpenBalance;

   if(dd > MaxDailyDrawdownPercent)
     {
      if(!g_reinvesting) g_paused = true;
      Comment("â›” ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©");
      return;
     }

   if(g_paused && !g_reinvesting)
      return;

   if(!g_reinvesting && curBal >= TargetBalance)
     {
      g_reinvesting = true;
      g_paused = true;
      Comment("ğŸ’° ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø§Ù„ÙŠ. ÙˆØ¶Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ù†Ø´Ø·. EA Ù…ØªÙˆÙ‚Ù.");
      return;
     }

   if(g_reinvesting && curBal <= TargetBalance - ReinvestAmount)
     {
      g_reinvesting = false;
      g_paused = false;
      Comment("ğŸ”„ ØªÙ… Ø¥Ù†ÙØ§Ù‚ Ù…Ø¨Ù„Øº Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±. Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„ØªØ¯Ø§ÙˆÙ„.");
     }

   if(tm.hour < StartHour || tm.hour > EndHour)
      return;

   if(g_tradeCount >= MaxTradesPerDay)
      return;

   CheckAndAdjustPositions();

   if(EnableAggressiveMode)
     {
      for(int i = PositionsTotal() - 1; i >= 0; i--)
        {
         ulong ticket = PositionGetTicket(i);
         if(!PositionSelectByTicket(ticket))
            continue;
         if(PositionGetInteger(POSITION_MAGIC) != g_magic_aggressive)
            continue;

         double profit = PositionGetDouble(POSITION_PROFIT);
         datetime openTime = (datetime)PositionGetInteger(POSITION_TIME);

         if(profit > 0 && (now - openTime) >= 3)
           {
            trade.PositionClose(ticket);
           }
        }
     }

   double rsi    = GetValue(hRSI, PERIOD_CURRENT);
   double fEMA   = GetValue(hEMAFast, PERIOD_CURRENT);
   double sEMA   = GetValue(hEMASlow, PERIOD_CURRENT);
   double hfEMA  = GetValue(hEMA_HigherTF_Fast, HigherTF_EMA);
   double hsEMA  = GetValue(hEMA_HigherTF_Slow, HigherTF_EMA);

   bool emaSpreadOK = MathAbs(fEMA - sEMA) >= PipsToPoints(MinEMASpreadPips);

   if(!emaSpreadOK && !UseSimpleMode)
     {
      Comment("Ø§Ù„ØµÙÙ‚Ø§Øª:", g_tradeCount,
              " | Ø§Ù„Ø®Ø³Ø§Ø±Ø©:", DoubleToString(dd * 100, 2), "%",
              " | ÙØ±Ù‚ EMA ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ (", MinEMASpreadPips, " Ù†Ù‚Ø·Ø©)");
      return;
     }

   SignalType sig = NONE;
   string patternName = "";
   int patternStrength = 0;

// Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ù…Ø¹ÙŠØ©
   if(fEMA > sEMA || UseSimpleMode)
     {
      if(UseHammer && IsHammer(true))
        {
         sig = BUY;
         patternName = "Hammer";
         patternStrength = 3;
        }
      else
         if(UseInvertedHammer && IsInvertedHammer(true))
           {
            sig = BUY;
            patternName = "InvertedHammer";
            patternStrength = 2;
           }
         else
            if(UseEngulfing && IsEngulfing(true))
              {
               sig = BUY;
               patternName = "Engulfing";
               patternStrength = 4;
              }
            else
               if(UseDoji && IsDoji())
                 {
                  sig = BUY;
                  patternName = "Doji";
                  patternStrength = 1;
                 }
               else
                  if(UseMarubozu && IsMarubozu(true))
                    {
                     sig = BUY;
                     patternName = "Marubozu";
                     patternStrength = 4;
                    }
                  else
                     if(UsePinBar && IsPinBar(true))
                       {
                        sig = BUY;
                        patternName = "PinBar";
                        patternStrength = 3;
                       }
                     else
                        if(UseHarami && IsHarami(true))
                          {
                           sig = BUY;
                           patternName = "Harami";
                           patternStrength = 2;
                          }
                        else
                           if(UseMorningStar && IsMorningStar())
                             {
                              sig = BUY;
                              patternName = "MorningStar";
                              patternStrength = 5;
                             }
                           else
                              if(UsePiercingLine && IsPiercingLine())
                                {
                                 sig = BUY;
                                 patternName = "PiercingLine";
                                 patternStrength = 3;
                                }
                              else
                                 if(UseThreeWhiteSoldiers && IsThreeWhiteSoldiers())
                                   {
                                    sig = BUY;
                                    patternName = "ThreeWhiteSoldiers";
                                    patternStrength = 5;
                                   }
                                 else
                                    if(UseTweezer && IsTweezerBottom())
                                      {
                                       sig = BUY;
                                       patternName = "TweezerBottom";
                                       patternStrength = 3;
                                      }
                                    else
                                       if(UseKicker && IsBullishKicker())
                                         {
                                          sig = BUY;
                                          patternName = "BullishKicker";
                                          patternStrength = 5;
                                         }
     }
   else
      if(fEMA < sEMA || UseSimpleMode)
        {
         if(UseHammer && IsHammer(false))
           {
            sig = SELL;
            patternName = "Hammer";
            patternStrength = 3;
           }
         else
            if(UseInvertedHammer && IsInvertedHammer(false))
              {
               sig = SELL;
               patternName = "InvertedHammer";
               patternStrength = 2;
              }
            else
               if(UseEngulfing && IsEngulfing(false))
                 {
                  sig = SELL;
                  patternName = "Engulfing";
                  patternStrength = 4;
                 }
               else
                  if(UseDoji && IsDoji())
                    {
                     sig = SELL;
                     patternName = "Doji";
                     patternStrength = 1;
                    }
                  else
                     if(UseMarubozu && IsMarubozu(false))
                       {
                        sig = SELL;
                        patternName = "Marubozu";
                        patternStrength = 4;
                       }
                     else
                        if(UsePinBar && IsPinBar(false))
                          {
                           sig = SELL;
                           patternName = "PinBar";
                           patternStrength = 3;
                          }
                        else
                           if(UseHarami && IsHarami(false))
                             {
                              sig = SELL;
                              patternName = "Harami";
                              patternStrength = 2;
                             }
                           else
                              if(UseEveningStar && IsEveningStar())
                                {
                                 sig = SELL;
                                 patternName = "EveningStar";
                                 patternStrength = 5;
                                }
                              else
                                 if(UseDarkCloudCover && IsDarkCloudCover())
                                   {
                                    sig = SELL;
                                    patternName = "DarkCloudCover";
                                    patternStrength = 3;
                                   }
                                 else
                                    if(UseThreeBlackCrows && IsThreeBlackCrows())
                                      {
                                       sig = SELL;
                                       patternName = "ThreeBlackCrows";
                                       patternStrength = 5;
                                      }
                                    else
                                       if(UseTweezer && IsTweezerTop())
                                         {
                                          sig = SELL;
                                          patternName = "TweezerTop";
                                          patternStrength = 3;
                                         }
                                       else
                                          if(UseKicker && IsBearishKicker())
                                            {
                                             sig = SELL;
                                             patternName = "BearishKicker";
                                             patternStrength = 5;
                                            }
        }

   bool rsiCondition = !EnableRSIFilter ||
                       (sig == BUY && rsi < RSI_Oversold) ||
                       (sig == SELL && rsi > RSI_Overbought);

   if(sig != NONE && rsiCondition && (!DisableRepeating || lastSignal != patternName))
     {
      if(AutoDistributeByStrength)
        {
         if(patternStrength >= 4 && EnableSniperMode && (!UseStrongPatternsOnly || patternStrength >= 4))
           {
            if(ExecuteTrade(sig, patternName, MODE_SNIPER))
              {
               g_sniper_trades++;
               g_tradeCount++;
              }
           }
         if(patternStrength >= 2 && EnableAggressiveMode)
           {
            if(ExecuteTrade(sig, patternName, MODE_AGGRESSIVE))
              {
               g_aggressive_trades++;
               g_tradeCount++;
              }
           }
         if(EnableConservativeMode)
           {
            if(ExecuteTrade(sig, patternName, MODE_CONSERVATIVE))
              {
               g_conservative_trades++;
               g_tradeCount++;
              }
           }
        }
      else
        {
         if(EnableConservativeMode)
           {
            if(ExecuteTrade(sig, patternName, MODE_CONSERVATIVE))
              {
               g_conservative_trades++;
               g_tradeCount++;
              }
           }
         if(EnableAggressiveMode)
           {
            if(ExecuteTrade(sig, patternName, MODE_AGGRESSIVE))
              {
               g_aggressive_trades++;
               g_tradeCount++;
              }
           }
         if(EnableSniperMode && (!UseStrongPatternsOnly || patternStrength >= 4))
           {
            if(ExecuteTrade(sig, patternName, MODE_SNIPER))
              {
               g_sniper_trades++;
               g_tradeCount++;
              }
           }
        }

      lastSignal = patternName;
     }

   Comment("Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ", g_tradeCount, "/", MaxTradesPerDay,
           " | Ù…Ø­Ø§ÙØ¸: ", g_conservative_trades,
           " | Ø¹Ø¯ÙˆØ§Ù†ÙŠ: ", g_aggressive_trades,
           " | Ù‚Ù†Ø§Øµ: ", g_sniper_trades,
           " | Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©: ", DoubleToString(dd * 100, 2), "%",
           " | Ø¢Ø®Ø± Ø¥Ø´Ø§Ø±Ø©: ", sig == BUY ? "Ø´Ø±Ø§Ø¡" : sig == SELL ? "Ø¨ÙŠØ¹" : "Ù„Ø§ ÙŠÙˆØ¬Ø¯", " (", patternName, ")",
           " | Ù‚ÙˆØ© Ø§Ù„Ù†Ù…Ø·: ", patternStrength,
           " | RSI: ", DoubleToString(rsi, 2));
  }

//+------------------------------------------------------------------+
//| Ø­Ù…Ø§ÙŠØ© Ù…Ù† SL/TP Ø§Ù„Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚                                 |
//+------------------------------------------------------------------+
void AdjustSLTPAwayFromMarket(double &sl, double &tp, long type)
{
   double marketPrice = (type == POSITION_TYPE_BUY) ? SymbolInfoDouble(g_symbol, SYMBOL_BID)
                                                    : SymbolInfoDouble(g_symbol, SYMBOL_ASK);

   double minDistance = SymbolInfoInteger(g_symbol, SYMBOL_TRADE_STOPS_LEVEL) * _Point;
   if(minDistance < _Point * MinDistanceFromMarket)
      minDistance = _Point * MinDistanceFromMarket;

   if(type == POSITION_TYPE_BUY)
   {
      if(sl >= marketPrice || (marketPrice - sl) < minDistance)
         sl = marketPrice - minDistance;

      if(tp <= marketPrice || (tp - marketPrice) < minDistance)
         tp = marketPrice + minDistance;
   }
   else
   {
      if(sl <= marketPrice || (sl - marketPrice) < minDistance)
         sl = marketPrice + minDistance;

      if(tp >= marketPrice || (marketPrice - tp) < minDistance)
         tp = marketPrice - minDistance;
   }

   if(fabs(tp - sl) < _Point * 2)
   {
      tp = marketPrice + ((type == POSITION_TYPE_BUY) ? minDistance * 1.5 : -minDistance * 1.5);
   }
}


//+------------------------------------------------------------------+
bool ExecuteTrade(SignalType sig, string patternName, StrategyMode mode)
  {
   if(mode == MODE_SNIPER && UseStrongPatternsOnly && GetPatternStrength(patternName) < 4)
      return false;

   double price = (sig == BUY) ? SymbolInfoDouble(g_symbol, SYMBOL_ASK)
                  : SymbolInfoDouble(g_symbol, SYMBOL_BID);

   double atr = GetValue(hATR, PERIOD_CURRENT);
   if(atr <= 0)
      atr = _Point * 100;

   double stopLoss, takeProfit;
   double riskPercent;
   int magic;

   switch(mode)
     {
      case MODE_CONSERVATIVE:
         riskPercent = ConservativeRiskPercent;
         magic = g_magic_conservative;
         break;
      case MODE_AGGRESSIVE:
         riskPercent = AggressiveRiskPercent;
         magic = g_magic_aggressive;
         break;
      case MODE_SNIPER:
         riskPercent = SniperRiskPercent;
         magic = g_magic_sniper;
         break;
      default:
         riskPercent = ConservativeRiskPercent;
         magic = g_magic_conservative;
         break;
     }

   if(UsePercentageTP_SL)
     {
      stopLoss = (sig == BUY) ? price * (1 - StopLossPct)
                 : price * (1 + StopLossPct);
      takeProfit = (sig == BUY) ? price * (1 + TakeProfitPct)
                   : price * (1 - TakeProfitPct);
     }
   else
     {
      double slMultiplier = SL_Multiplier;
      double tpMultiplier = TP_Multiplier;

      if(mode == MODE_AGGRESSIVE)
        {
         slMultiplier *= 0.7;
         tpMultiplier *= 0.7;
        }
      else if(mode == MODE_SNIPER)
        {
         slMultiplier *= 1.2;
         tpMultiplier *= 2.0;
        }

      stopLoss = (sig == BUY) ? price - atr * slMultiplier
                 : price + atr * slMultiplier;
      takeProfit = (sig == BUY) ? price + atr * tpMultiplier
                   : price - atr * tpMultiplier;
     }

   stopLoss = NormalizeDouble(stopLoss, g_digits);
   takeProfit = NormalizeDouble(takeProfit, g_digits);

   if((sig == BUY && (stopLoss >= price || takeProfit <= price)) ||
      (sig == SELL && (stopLoss <= price || takeProfit >= price)))
     {
      stopLoss = 0;
      takeProfit = 0;
     }

   // âœ… Ø£Ù…Ø§Ù† Ø¥Ø¶Ø§ÙÙŠ Ø¶Ø¯ SL/TP Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø³ÙˆÙ‚
   long type = (sig == BUY) ? POSITION_TYPE_BUY : POSITION_TYPE_SELL;
   AdjustSLTPAwayFromMarket(stopLoss, takeProfit, type);

   double lotSize = CalculateLotSize(riskPercent);
   bool result = false;

   trade.SetExpertMagicNumber(magic);

   switch(ExecutionType)
     {
      case MARKET_EXECUTION:
         result = trade.PositionOpen(g_symbol,
                                     (sig == BUY) ? ORDER_TYPE_BUY : ORDER_TYPE_SELL,
                                     lotSize, NormalizeDouble(price, g_digits),
                                     stopLoss, takeProfit);
         break;

      case LIMIT_ORDERS:
        {
         double limitPrice = (sig == BUY) ? price - PipsToPoints(LimitOrderPips)
                             : price + PipsToPoints(LimitOrderPips);
         limitPrice = NormalizeDouble(limitPrice, g_digits);
         result = (sig == BUY) ? trade.BuyLimit(lotSize, limitPrice, g_symbol, stopLoss, takeProfit)
                  : trade.SellLimit(lotSize, limitPrice, g_symbol, stopLoss, takeProfit);
         break;
        }

      case STOP_ORDERS:
        {
         double stopPrice = (sig == BUY) ? price + PipsToPoints(StopOrderPips)
                            : price - PipsToPoints(StopOrderPips);
         stopPrice = NormalizeDouble(stopPrice, g_digits);
         result = (sig == BUY) ? trade.BuyStop(lotSize, stopPrice, g_symbol, stopLoss, takeProfit)
                  : trade.SellStop(lotSize, stopPrice, g_symbol, stopLoss, takeProfit);
         break;
        }
     }

   if(result)
     {
      Print("âœ… ØµÙÙ‚Ø© ", (sig == BUY ? "Ø´Ø±Ø§Ø¡" : "Ø¨ÙŠØ¹"), " Ø¹Ù„Ù‰ Ù†Ù…Ø· ", patternName, " ÙÙŠ ÙˆØ¶Ø¹ ",
            (mode == MODE_CONSERVATIVE ? "Ù…Ø­Ø§ÙØ¸" : mode == MODE_AGGRESSIVE ? "Ø¹Ø¯ÙˆØ§Ù†ÙŠ" : "Ù‚Ù†Ø§Øµ"),
            " Ø¨Ø­Ø¬Ù… ", DoubleToString(lotSize, 2));
     }
   else
     {
      Print("âŒ ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø©: ", GetLastError());
     }

   return result;
  }


//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
void HandleAdaptiveLot()
  {
// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ø¨Ø¹Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©
   HistorySelect(TimeCurrent() - 86400 * 7, TimeCurrent());

   for(int i = HistoryDealsTotal() - 1; i >= 0; i--)
     {
      ulong ticket = HistoryDealGetTicket(i);

      if(ticket <= lastProcessedDeal)
         break;

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£ÙŠ ØµÙÙ‚Ø© ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¥ÙƒØ³Ø¨Ø±Øª (Ø£ÙŠ ÙˆØ¶Ø¹)
      if(HistoryDealGetInteger(ticket, DEAL_MAGIC) != g_magic_conservative &&
         HistoryDealGetInteger(ticket, DEAL_MAGIC) != g_magic_aggressive &&
         HistoryDealGetInteger(ticket, DEAL_MAGIC) != g_magic_sniper)
         continue;

      if(HistoryDealGetInteger(ticket, DEAL_ENTRY) != DEAL_ENTRY_OUT)
         continue;

      double profit = HistoryDealGetDouble(ticket, DEAL_PROFIT);

      if(profit > 0)
        {
         g_consecutiveWins++;
         g_consecutiveLosses = 0;
        }
      else
        {
         g_consecutiveLosses++;
         g_consecutiveWins = 0;
        }

      lastProcessedDeal = ticket;
      break;
     }
  }

//+------------------------------------------------------------------+
double PipsToPoints(double pips)
  {
   return pips * SymbolInfoDouble(g_symbol, SYMBOL_POINT);
  }

//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
double GetValue(int handle, ENUM_TIMEFRAMES tf, int shift = 0)
  {
   double buf[];
   if(CopyBuffer(handle, 0, shift, 1, buf) <= 0)
     {
      Print("âŒ ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø¤Ø´Ø± (handle = ", handle, ")");
      return 0.0;
     }
   return buf[0];
  }

//+------------------------------------------------------------------+
double CalculateLotSize(double riskPercent)
  {
   if(UseFixedLot)
      return FixedLot;
   double equity = AccountInfoDouble(ACCOUNT_EQUITY);
   double atr = GetValue(hATR, PERIOD_CURRENT);
   if(atr <= 0)
      atr = _Point * 100; // ATR Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ØªØ§Ø­Ø§Ù‹

   double riskDollar = equity * riskPercent;
   double slPips = atr * SL_Multiplier / SymbolInfoDouble(g_symbol, SYMBOL_POINT); // ØªØ­ÙˆÙŠÙ„ ATR Ø¥Ù„Ù‰ Ù†Ù‚Ø§Ø· Ù„Ø­Ø³Ø§Ø¨ SL
   if(slPips <= 0)
      slPips = 10; // SL Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† ATR ØµÙØ±Ø§Ù‹ Ø£Ùˆ Ø³Ø§Ù„Ø¨Ø§Ù‹

   double tickValue = SymbolInfoDouble(g_symbol, SYMBOL_TRADE_TICK_VALUE);

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„ÙƒÙ„ Ù„ÙˆØª Ù„ÙƒÙ„ Ù†Ù‚Ø·Ø©
   double dollarPerPip = tickValue / SymbolInfoDouble(g_symbol, SYMBOL_POINT); // Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ù„ÙƒÙ„ Ù„ÙˆØª

// ØªØ¬Ù†Ø¨ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ØµÙØ±
   if(dollarPerPip <= 0)
      dollarPerPip = 0.01; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ØµØºÙŠØ±Ø© Ø¥Ø°Ø§ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯Ù‡Ø§

   double lot = riskDollar / (slPips * dollarPerPip);

   double minLot = SymbolInfoDouble(g_symbol, SYMBOL_VOLUME_MIN);
   double maxLot = SymbolInfoDouble(g_symbol, SYMBOL_VOLUME_MAX);
   double step   = SymbolInfoDouble(g_symbol, SYMBOL_VOLUME_STEP);

   lot = MathMax(minLot, MathMin(maxLot, MathRound(lot / step) * step));
   return lot;
  }

//+------------------------------------------------------------------+
void CheckAndAdjustPositions()
  {
   int total = PositionsTotal();
   for(int idx = total - 1; idx >= 0; idx--) // Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ù„Ø®Ù„Ù Ù„Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¢Ù…Ù† Ù„Ù„Ù…Ø±Ø§ÙƒØ²
     {
      ulong ticket = PositionGetTicket(idx);
      if(!PositionSelectByTicket(ticket))
         continue;

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙÙ‚Ø© ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¥ÙƒØ³Ø¨Ø±Øª (Ø£ÙŠ ÙˆØ¶Ø¹)
      long magic = PositionGetInteger(POSITION_MAGIC);
      if(magic != g_magic_conservative && magic != g_magic_aggressive && magic != g_magic_sniper)
         continue;

      if(PositionGetString(POSITION_SYMBOL) != g_symbol)
         continue;

      long   type  = PositionGetInteger(POSITION_TYPE);
      double openP = PositionGetDouble(POSITION_PRICE_OPEN);
      double sl    = PositionGetDouble(POSITION_SL);
      double tp    = PositionGetDouble(POSITION_TP);
      double currentPrice = (type == POSITION_TYPE_BUY ?
                             SymbolInfoDouble(g_symbol, SYMBOL_BID) :
                             SymbolInfoDouble(g_symbol, SYMBOL_ASK));

      // Ù†Ù‚Ù„ SL Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„
      if(BreakevenPips > 0)
        {
         double pipsProfit = (type == POSITION_TYPE_BUY ?
                              (currentPrice - openP) / SymbolInfoDouble(g_symbol, SYMBOL_POINT) :
                              (openP - currentPrice) / SymbolInfoDouble(g_symbol, SYMBOL_POINT));
         if(pipsProfit >= BreakevenPips)
           {
            double newSL = openP; // Ø¶Ø¨Ø· SL Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø§Ù„ÙØªØ­
            if(sl == 0 || (type == POSITION_TYPE_BUY && newSL > sl) || (type == POSITION_TYPE_SELL && newSL < sl))
              {
               AdjustSLTPAwayFromMarket(newSL, tp, type); // âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø±Ø¨ Ù„Ù„Ø³ÙˆÙ‚
               trade.PositionModify(ticket, NormalizeDouble(newSL, g_digits), tp);
              }
           }
        }

      // ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ù…ØªØ­Ø±Ùƒ
      if(TrailingStopPips > 0)
        {
         double profitPips = (type == POSITION_TYPE_BUY ?
                              (currentPrice - openP) / SymbolInfoDouble(g_symbol, SYMBOL_POINT) :
                              (openP - currentPrice) / SymbolInfoDouble(g_symbol, SYMBOL_POINT));

         if(profitPips >= TrailingStopPips)
           {
            double newSL = (type == POSITION_TYPE_BUY ?
                            currentPrice - PipsToPoints(TrailingStopPips) :
                            currentPrice + PipsToPoints(TrailingStopPips));
            // ØªØ¹Ø¯ÙŠÙ„ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† newSL Ø£ÙØ¶Ù„ (Ø£Ø¨Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø±Ø¨Ø­) Ù…Ù† SL Ø§Ù„Ø­Ø§Ù„ÙŠ
            if((type == POSITION_TYPE_BUY && newSL > sl) ||
               (type == POSITION_TYPE_SELL && newSL < sl) || sl == 0)
              {
               AdjustSLTPAwayFromMarket(newSL, tp, type); // âœ… Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø±Ø¨ Ù„Ù„Ø³ÙˆÙ‚
               trade.PositionModify(ticket, NormalizeDouble(newSL, g_digits), tp);
              }
           }
        }
     }
  }

//+------------------------------------------------------------------+
// ØªÙ†ÙÙŠØ° Ø¯ÙˆØ§Ù„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ù…ÙˆØ¹
//+------------------------------------------------------------------+

//+------------------------------------------------------------------+
bool IsHammer(bool bullish)
  {
   double o = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c = iClose(g_symbol, PERIOD_CURRENT, 0);
   double h = iHigh(g_symbol, PERIOD_CURRENT, 0);
   double l = iLow(g_symbol, PERIOD_CURRENT, 0);
   double body = MathAbs(c - o);
   double lowerWick = MathMin(o, c) - l;
   double upperWick = h - MathMax(o, c);
   double range = h - l;

   if(body == 0 || range == 0)
      return false;

// Ø§Ù„Ù…Ø·Ø±Ù‚Ø©: Ø¬Ø³Ù… ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙˆØ¸Ù„ Ø³ÙÙ„ÙŠ Ø·ÙˆÙŠÙ„
   return (body <= 0.3 * range &&
           lowerWick >= 2 * body &&
           upperWick <= 0.1 * range &&
           (bullish ? c > o : true));
  }

//+------------------------------------------------------------------+
bool IsInvertedHammer(bool bullish)
  {
   double o = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c = iClose(g_symbol, PERIOD_CURRENT, 0);
   double h = iHigh(g_symbol, PERIOD_CURRENT, 0);
   double l = iLow(g_symbol, PERIOD_CURRENT, 0);
   double body = MathAbs(c - o);
   double lowerWick = MathMin(o, c) - l;
   double upperWick = h - MathMax(o, c);
   double range = h - l;

   if(body == 0 || range == 0)
      return false;

// Ø§Ù„Ù…Ø·Ø±Ù‚Ø© Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø©: Ø¬Ø³Ù… ØµØºÙŠØ± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ ÙˆØ¸Ù„ Ø¹Ù„ÙˆÙŠ Ø·ÙˆÙŠÙ„
   return (body <= 0.3 * range &&
           upperWick >= 2 * body &&
           lowerWick <= 0.1 * range &&
           (bullish ? c > o : true));
  }

//+------------------------------------------------------------------+
bool IsEngulfing(bool bullish)
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);

   if(bullish)
     {
      // Ù†Ù…Ø· Ø§Ø¨ØªÙ„Ø§Ø¹ ØµØ§Ø¹Ø¯: Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ØªØ¨ØªÙ„Ø¹ Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© Ø³Ø§Ø¨Ù‚Ø©
      return (c1 < o1 && c0 > o0 && o0 <= c1 && c0 >= o1);
     }
   else
     {
      // Ù†Ù…Ø· Ø§Ø¨ØªÙ„Ø§Ø¹ Ù‡Ø§Ø¨Ø·: Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ØªØ¨ØªÙ„Ø¹ Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© Ø³Ø§Ø¨Ù‚Ø©
      return (c1 > o1 && c0 < o0 && o0 >= c1 && c0 <= o1);
     }
  }

//+------------------------------------------------------------------+
bool IsDoji()
  {
   double o = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c = iClose(g_symbol, PERIOD_CURRENT, 0);
   double h = iHigh(g_symbol, PERIOD_CURRENT, 0);
   double l = iLow(g_symbol, PERIOD_CURRENT, 0);
   double range = h - l;

   if(range == 0)
      return false;

// Ø§Ù„Ø¯ÙˆØ¬ÙŠ: Ø¬Ø³Ù… ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„ÙƒÙ„ÙŠ
   return (MathAbs(c - o) <= 0.1 * range);
  }

//+------------------------------------------------------------------+
bool IsMarubozu(bool bullish)
  {
   double o = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c = iClose(g_symbol, PERIOD_CURRENT, 0);
   double h = iHigh(g_symbol, PERIOD_CURRENT, 0);
   double l = iLow(g_symbol, PERIOD_CURRENT, 0);
   double body = MathAbs(c - o);
   double range = h - l;

   if(range == 0)
      return false;

// Ø§Ù„Ù…Ø§Ø±ÙˆØ¨ÙˆØ²Ùˆ: Ø´Ù…Ø¹Ø© Ø°Ø§Øª Ø¬Ø³Ù… ÙƒØ¨ÙŠØ± ÙˆØ¸Ù„Ø§Ù„ ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ Ø£Ùˆ Ù…Ø¹Ø¯ÙˆÙ…Ø©
   if(body >= 0.9 * range)
     {
      if(bullish)
        {
         return (c > o && h - c <= 0.1 * range && o - l <= 0.1 * range);
        }
      else
        {
         return (c < o && h - o <= 0.1 * range && c - l <= 0.1 * range);
        }
     }

   return false;
  }

//+------------------------------------------------------------------+
bool IsPinBar(bool bullish)
  {
   double o = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c = iClose(g_symbol, PERIOD_CURRENT, 0);
   double h = iHigh(g_symbol, PERIOD_CURRENT, 0);
   double l = iLow(g_symbol, PERIOD_CURRENT, 0);
   double body = MathAbs(c - o);
   double upperWick = h - MathMax(o, c);
   double lowerWick = MathMin(o, c) - l;
   double range = h - l;

   if(range == 0 || body == 0)
      return false;

   if(bullish)
     {
      // Ø¨Ù† Ø¨Ø§Ø± ØµØ§Ø¹Ø¯: Ø¸Ù„ Ø³ÙÙ„ÙŠ Ø·ÙˆÙŠÙ„ØŒ Ø¬Ø³Ù… ØµØºÙŠØ±ØŒ Ø¸Ù„ Ø¹Ù„ÙˆÙŠ ØµØºÙŠØ±
      return (lowerWick > 2 * body &&
              upperWick < body &&
              body < range / 3 &&
              c > o &&
              upperWick < lowerWick / 3);
     }
   else
     {
      // Ø¨Ù† Ø¨Ø§Ø± Ù‡Ø§Ø¨Ø·: Ø¸Ù„ Ø¹Ù„ÙˆÙŠ Ø·ÙˆÙŠÙ„ØŒ Ø¬Ø³Ù… ØµØºÙŠØ±ØŒ Ø¸Ù„ Ø³ÙÙ„ÙŠ ØµØºÙŠØ±
      return (upperWick > 2 * body &&
              lowerWick < body &&
              body < range / 3 &&
              c < o &&
              lowerWick < upperWick / 3);
     }
  }

//+------------------------------------------------------------------+
bool IsHarami(bool bullish)
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double body0 = MathAbs(c0 - o0);
   double body1 = MathAbs(c1 - o1);

   if(bullish)
     {
      // Ø­Ø±Ø§Ù…ÙŠ ØµØ§Ø¹Ø¯: Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ØµØºÙŠØ±Ø© Ø¯Ø§Ø®Ù„ Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ÙƒØ¨ÙŠØ±Ø©
      return (c1 < o1 && c0 > o0 && body0 < body1 &&
              o0 > c1 && o0 < o1 && c0 > c1 && c0 < o1);
     }
   else
     {
      // Ø­Ø±Ø§Ù…ÙŠ Ù‡Ø§Ø¨Ø·: Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ØµØºÙŠØ±Ø© Ø¯Ø§Ø®Ù„ Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ÙƒØ¨ÙŠØ±Ø©
      return (c1 > o1 && c0 < o0 && body0 < body1 &&
              o0 < c1 && o0 > o1 && c0 < c1 && c0 > o1);
     }
  }

//+------------------------------------------------------------------+
bool IsMorningStar()
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double o2 = iOpen(g_symbol, PERIOD_CURRENT, 2);
   double c2 = iClose(g_symbol, PERIOD_CURRENT, 2);
   double body0 = MathAbs(c0 - o0);
   double body1 = MathAbs(c1 - o1);
   double body2 = MathAbs(c2 - o2);
   double range1 = iHigh(g_symbol, PERIOD_CURRENT, 1) - iLow(g_symbol, PERIOD_CURRENT, 1);

// Ù†Ø¬Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­: Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ÙƒØ¨ÙŠØ±Ø©ØŒ ØªÙ„ÙŠÙ‡Ø§ Ø´Ù…Ø¹Ø© ØµØºÙŠØ±Ø©ØŒ Ø«Ù… Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ÙƒØ¨ÙŠØ±Ø©
   return (c2 < o2 && body2 > 0.5 * range1 &&
           body1 < 0.3 * body2 &&
           c0 > o0 && body0 > 0.5 * range1 &&
           c0 > (o2 + c2) / 2);
  }

//+------------------------------------------------------------------+
bool IsEveningStar()
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double o2 = iOpen(g_symbol, PERIOD_CURRENT, 2);
   double c2 = iClose(g_symbol, PERIOD_CURRENT, 2);
   double body0 = MathAbs(c0 - o0);
   double body1 = MathAbs(c1 - o1);
   double body2 = MathAbs(c2 - o2);
   double range1 = iHigh(g_symbol, PERIOD_CURRENT, 1) - iLow(g_symbol, PERIOD_CURRENT, 1);

// Ù†Ø¬Ù…Ø© Ø§Ù„Ù…Ø³Ø§Ø¡: Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ÙƒØ¨ÙŠØ±Ø©ØŒ ØªÙ„ÙŠÙ‡Ø§ Ø´Ù…Ø¹Ø© ØµØºÙŠØ±Ø©ØŒ Ø«Ù… Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ÙƒØ¨ÙŠØ±Ø©
   return (c2 > o2 && body2 > 0.5 * range1 &&
           body1 < 0.3 * body2 &&
           c0 < o0 && body0 > 0.5 * range1 &&
           c0 < (o2 + c2) / 2);
  }

//+------------------------------------------------------------------+
bool IsPiercingLine()
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double body1 = MathAbs(c1 - o1);

// Ø®Ø· Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚: Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ØªÙ„ÙŠÙ‡Ø§ Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ØªÙØªØ­ Ø£Ù‚Ù„ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØªØºÙ„Ù‚ ÙÙˆÙ‚ Ù…Ù†ØªØµÙ Ø¬Ø³Ù… Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
   return (c1 < o1 && c0 > o0 && o0 < c1 && c0 > (o1 + c1) / 2 && c0 < o1);
  }

//+------------------------------------------------------------------+
bool IsDarkCloudCover()
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double body1 = MathAbs(c1 - o1);

// Ø§Ù„ØºØ·Ø§Ø¡ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ: Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ØªÙ„ÙŠÙ‡Ø§ Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ØªÙØªØ­ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØªØºÙ„Ù‚ ØªØ­Øª Ù…Ù†ØªØµÙ Ø¬Ø³Ù… Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
   return (c1 > o1 && c0 < o0 && o0 > c1 && c0 < (o1 + c1) / 2 && c0 > o1);
  }

//+------------------------------------------------------------------+
bool IsThreeWhiteSoldiers()
  {
// Ø§Ù„Ø¬Ù†ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ¶ Ø§Ù„Ø«Ù„Ø§Ø«Ø©: Ø«Ù„Ø§Ø« Ø´Ù…ÙˆØ¹ ØµØ§Ø¹Ø¯Ø© Ù…ØªØªØ§Ù„ÙŠØ©ØŒ ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø© ØªÙØªØ­ Ø¯Ø§Ø®Ù„ Ø¬Ø³Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØªØºÙ„Ù‚ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
   if(iClose(g_symbol, PERIOD_CURRENT, 0) <= iOpen(g_symbol, PERIOD_CURRENT, 0) ||
      iClose(g_symbol, PERIOD_CURRENT, 1) <= iOpen(g_symbol, PERIOD_CURRENT, 1) ||
      iClose(g_symbol, PERIOD_CURRENT, 2) <= iOpen(g_symbol, PERIOD_CURRENT, 2))
      return false;

   if(iClose(g_symbol, PERIOD_CURRENT, 0) <= iClose(g_symbol, PERIOD_CURRENT, 1) ||
      iClose(g_symbol, PERIOD_CURRENT, 1) <= iClose(g_symbol, PERIOD_CURRENT, 2))
      return false;

   if(iOpen(g_symbol, PERIOD_CURRENT, 0) < iOpen(g_symbol, PERIOD_CURRENT, 1) ||
      iOpen(g_symbol, PERIOD_CURRENT, 0) > iClose(g_symbol, PERIOD_CURRENT, 1) ||
      iOpen(g_symbol, PERIOD_CURRENT, 1) < iOpen(g_symbol, PERIOD_CURRENT, 2) ||
      iOpen(g_symbol, PERIOD_CURRENT, 1) > iClose(g_symbol, PERIOD_CURRENT, 2))
      return false;

   return true;
  }

//+------------------------------------------------------------------+
bool IsThreeBlackCrows()
  {
// Ø§Ù„ØºØ±Ø¨Ø§Ù† Ø§Ù„Ø³ÙˆØ¯ Ø§Ù„Ø«Ù„Ø§Ø«Ø©: Ø«Ù„Ø§Ø« Ø´Ù…ÙˆØ¹ Ù‡Ø§Ø¨Ø·Ø© Ù…ØªØªØ§Ù„ÙŠØ©ØŒ ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø© ØªÙØªØ­ Ø¯Ø§Ø®Ù„ Ø¬Ø³Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØªØºÙ„Ù‚ Ø£Ù‚Ù„ Ù…Ù† Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
   if(iClose(g_symbol, PERIOD_CURRENT, 0) >= iOpen(g_symbol, PERIOD_CURRENT, 0) ||
      iClose(g_symbol, PERIOD_CURRENT, 1) >= iOpen(g_symbol, PERIOD_CURRENT, 1) ||
      iClose(g_symbol, PERIOD_CURRENT, 2) >= iOpen(g_symbol, PERIOD_CURRENT, 2))
      return false;

   if(iClose(g_symbol, PERIOD_CURRENT, 0) >= iClose(g_symbol, PERIOD_CURRENT, 1) ||
      iClose(g_symbol, PERIOD_CURRENT, 1) >= iClose(g_symbol, PERIOD_CURRENT, 2))
      return false;

   if(iOpen(g_symbol, PERIOD_CURRENT, 0) > iOpen(g_symbol, PERIOD_CURRENT, 1) ||
      iOpen(g_symbol, PERIOD_CURRENT, 0) < iClose(g_symbol, PERIOD_CURRENT, 1) ||
      iOpen(g_symbol, PERIOD_CURRENT, 1) > iOpen(g_symbol, PERIOD_CURRENT, 2) ||
      iOpen(g_symbol, PERIOD_CURRENT, 1) < iClose(g_symbol, PERIOD_CURRENT, 2))
      return false;

   return true;
  }

//+------------------------------------------------------------------+
bool IsTweezerBottom()
  {
   double l0 = iLow(g_symbol, PERIOD_CURRENT, 0);
   double l1 = iLow(g_symbol, PERIOD_CURRENT, 1);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);

// ØªÙˆÙŠØ²Ø± Ø¨ÙˆØªÙˆÙ…: Ø´Ù…Ø¹ØªØ§Ù† Ù…ØªØªØ§Ù„ÙŠØªØ§Ù† Ù„Ù‡Ù…Ø§ Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ø¹ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ØŒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡Ø§Ø¨Ø·Ø© ÙˆØ§Ù„Ø«Ø§Ù†ÙŠØ© ØµØ§Ø¹Ø¯Ø©
   return (MathAbs(l0 - l1) <= PipsToPoints(2) && c1 < o1 && c0 > o0);
  }

//+------------------------------------------------------------------+
bool IsTweezerTop()
  {
   double h0 = iHigh(g_symbol, PERIOD_CURRENT, 0);
   double h1 = iHigh(g_symbol, PERIOD_CURRENT, 1);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);

// ØªÙˆÙŠØ²Ø± ØªÙˆØ¨: Ø´Ù…Ø¹ØªØ§Ù† Ù…ØªØªØ§Ù„ÙŠØªØ§Ù† Ù„Ù‡Ù…Ø§ Ù†ÙØ³ Ø§Ù„Ù‚Ù…Ø© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ØŒ Ø§Ù„Ø£ÙˆÙ„Ù‰ ØµØ§Ø¹Ø¯Ø© ÙˆØ§Ù„Ø«Ø§Ù†ÙŠØ© Ù‡Ø§Ø¨Ø·Ø©
   return (MathAbs(h0 - h1) <= PipsToPoints(2) && c1 > o1 && c0 < o0);
  }

//+------------------------------------------------------------------+
bool IsBullishKicker()
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);

// ÙƒÙŠÙƒØ± ØµØ§Ø¹Ø¯: Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ØªÙ„ÙŠÙ‡Ø§ Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ØªÙØªØ­ Ø¨ÙØ¬ÙˆØ© ØµØ¹ÙˆØ¯ÙŠØ© ÙƒØ¨ÙŠØ±Ø©
   return (c1 < o1 && c0 > o0 && o0 > o1 && o0 - o1 > PipsToPoints(5));
  }

//+------------------------------------------------------------------+
bool IsBearishKicker()
  {
   double o0 = iOpen(g_symbol, PERIOD_CURRENT, 0);
   double c0 = iClose(g_symbol, PERIOD_CURRENT, 0);
   double o1 = iOpen(g_symbol, PERIOD_CURRENT, 1);
   double c1 = iClose(g_symbol, PERIOD_CURRENT, 1);

// ÙƒÙŠÙƒØ± Ù‡Ø§Ø¨Ø·: Ø´Ù…Ø¹Ø© ØµØ§Ø¹Ø¯Ø© ØªÙ„ÙŠÙ‡Ø§ Ø´Ù…Ø¹Ø© Ù‡Ø§Ø¨Ø·Ø© ØªÙØªØ­ Ø¨ÙØ¬ÙˆØ© Ù‡Ø¨ÙˆØ·ÙŠØ© ÙƒØ¨ÙŠØ±Ø©
   return (c1 > o1 && c0 < o0 && o0 < o1 && o1 - o0 > PipsToPoints(5));
  }

//+------------------------------------------------------------------+
// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù‚ÙˆØ© Ø§Ù„Ù†Ù…Ø· (1-5)
int GetPatternStrength(string patternName)
  {
   if(patternName == "MorningStar" || patternName == "EveningStar" ||
      patternName == "ThreeWhiteSoldiers" || patternName == "ThreeBlackCrows" ||
      patternName == "BullishKicker" || patternName == "BearishKicker")
      return 5; // Ø£Ù†Ù…Ø§Ø· Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹

   if(patternName == "Engulfing" || patternName == "Marubozu")
      return 4; // Ø£Ù†Ù…Ø§Ø· Ù‚ÙˆÙŠØ©

   if(patternName == "Hammer" || patternName == "PinBar" ||
      patternName == "PiercingLine" || patternName == "DarkCloudCover" ||
      patternName == "TweezerBottom" || patternName == "TweezerTop")
      return 3; // Ø£Ù†Ù…Ø§Ø· Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ù‚ÙˆØ©

   if(patternName == "InvertedHammer" || patternName == "Harami")
      return 2; // Ø£Ù†Ù…Ø§Ø· Ø¶Ø¹ÙŠÙØ©

   if(patternName == "Doji")
      return 1; // Ø£Ù†Ù…Ø§Ø· Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹

   return 0; // ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ
  }

//+------------------------------------------------------------------+
